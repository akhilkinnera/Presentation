<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="NAU MPCT Command Center - Advanced Laboratory Operating System">
    <title>NAU.OS v4.0 | MPCT Command</title>

    <!-- 
        FONTS 
        Using a tech-focused pairing: 'Rajdhani' for UI/Heads-up display elements, 
        and 'Source Sans 3' for readability, keeping the NAU brand font in the mix.
    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&family=Source+Code+Pro:wght@400;600&family=Source+Sans+3:ital,wght@0,300;0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        /* ================================================================================
        1. DESIGN SYSTEM & VARIABLES (LINES 1-300)
        ================================================================================
        */
        :root {
            /* Brand Colors */
            --nau-blue: #002454;
            --nau-blue-deep: #001229;
            --nau-blue-glass: rgba(0, 36, 84, 0.65);
            --nau-gold: #FAC01A;
            --nau-gold-dim: #b88b0e;
            --nau-gold-glow: rgba(250, 192, 26, 0.4);
            
            /* Status Colors */
            --status-ok: #00ff9d;
            --status-warn: #fac01a;
            --status-crit: #ff2a2a;
            --status-idle: #546e7a;

            /* UI Colors */
            --bg-color: #050a14;
            --window-bg: rgba(9, 17, 33, 0.85);
            --window-border: rgba(255, 255, 255, 0.1);
            --text-main: #e0f2ff;
            --text-muted: #8da6b8;
            --grid-line: rgba(0, 58, 133, 0.2);

            /* Effects */
            --glass-blur: blur(12px);
            --crt-scanline: rgba(0,0,0,0.1);
            --shadow-window: 0 20px 50px rgba(0,0,0,0.5);
            
            /* Fonts */
            --font-ui: 'Rajdhani', sans-serif;
            --font-code: 'Source Code Pro', monospace;
            --font-body: 'Source Sans 3', sans-serif;

            /* Z-Indices */
            --z-bg: 0;
            --z-desktop: 10;
            --z-window: 100;
            --z-window-active: 200;
            --z-overlay: 1000;
            --z-cursor: 9999;
        }

        /* ================================================================================
        2. GLOBAL RESET & BASE
        ================================================================================
        */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            cursor: none; /* Custom cursor used */
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-body);
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* App style */
            font-size: 16px;
            user-select: none;
        }

        /* Custom Scrollbars */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        ::-webkit-scrollbar-thumb { background: var(--nau-blue); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--nau-gold); }

        /* Custom Cursor */
        #cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 2px solid var(--nau-gold);
            border-radius: 50%;
            pointer-events: none;
            z-index: var(--z-cursor);
            transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s, background 0.2s;
            mix-blend-mode: difference;
        }
        #cursor.hovered {
            width: 40px;
            height: 40px;
            background: rgba(250, 192, 26, 0.2);
            border-color: var(--status-ok);
        }
        #cursor::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 4px; height: 4px;
            background: var(--nau-gold);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        /* Background Effects */
        #bg-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: var(--z-bg);
            opacity: 0.4;
        }

        .scanlines {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            z-index: var(--z-bg);
            pointer-events: none;
            opacity: 0.3;
        }

        /* ================================================================================
        3. BOOT SEQUENCE UI
        ================================================================================
        */
        #boot-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: var(--font-code);
            color: var(--nau-gold);
        }

        .boot-logo {
            width: 120px;
            margin-bottom: 40px;
            filter: drop-shadow(0 0 10px var(--nau-gold));
            animation: pulseLogo 2s infinite;
        }

        @keyframes pulseLogo {
            0% { opacity: 0.8; }
            50% { opacity: 1; filter: drop-shadow(0 0 20px var(--nau-gold)); }
            100% { opacity: 0.8; }
        }

        .boot-log {
            width: 600px;
            max-width: 90%;
            height: 200px;
            overflow: hidden;
            font-size: 0.8rem;
            color: #fff;
            border-left: 2px solid var(--nau-blue);
            padding-left: 20px;
        }

        .log-line { margin-bottom: 4px; opacity: 0; animation: fadeInLog 0.1s forwards; }
        .log-line.success { color: var(--status-ok); }
        .log-line.warn { color: var(--status-warn); }
        
        @keyframes fadeInLog { to { opacity: 1; } }

        .loading-bar {
            width: 300px;
            height: 4px;
            background: #333;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .loading-progress {
            position: absolute;
            top: 0; left: 0;
            height: 100%;
            background: var(--nau-gold);
            width: 0%;
            transition: width 0.2s;
            box-shadow: 0 0 10px var(--nau-gold);
        }

        /* ================================================================================
        4. DESKTOP ENVIRONMENT
        ================================================================================
        */
        #desktop {
            position: relative;
            width: 100%;
            height: 100%;
            z-index: var(--z-desktop);
            padding: 60px 20px 20px 20px; /* Space for Top Bar */
            opacity: 0; /* Hidden initially */
            transition: opacity 1s;
        }

        /* Top Bar */
        .system-bar {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 48px;
            background: rgba(0, 18, 41, 0.9);
            backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid var(--nau-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: var(--z-overlay);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .sys-left { display: flex; align-items: center; gap: 20px; }
        .sys-right { display: flex; align-items: center; gap: 20px; font-family: var(--font-code); font-size: 0.85rem; }

        .sys-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: var(--font-ui);
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--white);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .sys-logo span { color: var(--nau-gold); }

        .sys-clock { color: var(--nau-gold); text-shadow: 0 0 5px var(--nau-gold-glow); }
        .sys-status { display: flex; align-items: center; gap: 8px; color: var(--status-ok); }
        .sys-dot { width: 8px; height: 8px; background: currentColor; border-radius: 50%; box-shadow: 0 0 5px currentColor; animation: blink 2s infinite; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Desktop Shortcuts */
        .shortcut-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: absolute;
            top: 80px;
            left: 30px;
        }

        .shortcut {
            width: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.2s;
            text-align: center;
        }

        .shortcut:hover {
            background: rgba(255,255,255,0.1);
        }

        .shortcut-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--nau-blue), var(--nau-blue-deep));
            border: 1px solid var(--nau-gold);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(0, 36, 84, 0.5);
            font-size: 1.5rem;
            color: var(--nau-gold);
        }

        .shortcut-label {
            font-family: var(--font-ui);
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--white);
            text-shadow: 0 2px 4px #000;
        }

        /* Widgets Area (Right Side) */
        .widget-area {
            position: absolute;
            top: 80px;
            right: 30px;
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .widget {
            background: rgba(0, 20, 45, 0.7);
            border: 1px solid var(--nau-blue);
            backdrop-filter: blur(10px);
            border-radius: 4px;
            padding: 15px;
            position: relative;
            overflow: hidden;
        }

        .widget::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 4px; height: 100%;
            background: var(--nau-gold);
        }

        .widget-title {
            font-family: var(--font-ui);
            text-transform: uppercase;
            font-weight: 700;
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        /* Env Widget */
        .env-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .env-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; text-align: center; }
        .env-val { font-family: var(--font-code); font-size: 1.2rem; color: var(--white); font-weight: 700; }
        .env-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; margin-top: 4px; }

        /* Notification Widget */
        .notif-list { display: flex; flex-direction: column; gap: 8px; max-height: 200px; overflow-y: auto; }
        .notif-item { font-size: 0.8rem; padding: 8px; border-left: 2px solid var(--status-idle); background: rgba(0,0,0,0.2); }
        .notif-item.urgent { border-color: var(--status-crit); }
        .notif-time { font-family: var(--font-code); font-size: 0.7rem; color: var(--text-muted); display: block; margin-bottom: 2px; }

        /* ================================================================================
        5. WINDOWING SYSTEM
        ================================================================================
        */
        .window {
            position: absolute;
            background: var(--window-bg);
            border: 1px solid var(--nau-blue);
            border-radius: 8px;
            box-shadow: var(--shadow-window);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: var(--glass-blur);
            transition: transform 0.1s, opacity 0.2s;
            opacity: 0;
            transform: scale(0.95);
            pointer-events: none; /* Disabled until open */
        }

        .window.open {
            opacity: 1;
            transform: scale(1);
            pointer-events: all;
        }

        .window.minimized {
            opacity: 0;
            transform: translateY(100px) scale(0.5);
            pointer-events: none;
        }

        .window.active {
            border-color: var(--nau-gold);
            z-index: var(--z-window-active);
            box-shadow: 0 0 20px rgba(0, 36, 84, 0.6);
        }

        .title-bar {
            height: 36px;
            background: linear-gradient(to right, rgba(0, 36, 84, 0.8), rgba(0,0,0,0.5));
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            user-select: none;
        }

        .title-drag-area {
            flex-grow: 1;
            height: 100%;
            display: flex;
            align-items: center;
            font-family: var(--font-ui);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-main);
            font-size: 0.9rem;
        }
        
        .title-icon { margin-right: 8px; color: var(--nau-gold); }

        .window-controls { display: flex; gap: 8px; }
        .win-btn {
            width: 12px; height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.2);
            transition: 0.2s;
        }
        .win-close:hover { background: var(--status-crit); border-color: var(--status-crit); }
        .win-min:hover { background: var(--nau-gold); border-color: var(--nau-gold); }
        .win-max:hover { background: var(--status-ok); border-color: var(--status-ok); }

        .window-content {
            flex-grow: 1;
            overflow: hidden;
            position: relative;
            background: rgba(0,0,0,0.3);
        }

        /* ================================================================================
        6. APP SPECIFIC STYLES
        ================================================================================
        */

        /* Common Elements */
        .app-layout { display: flex; height: 100%; }
        .app-sidebar {
            width: 200px;
            background: rgba(0,0,0,0.2);
            border-right: 1px solid var(--grid-line);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .app-main { flex-grow: 1; padding: 20px; overflow-y: auto; position: relative; }

        .nav-btn {
            padding: 10px;
            text-align: left;
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-muted);
            font-family: var(--font-ui);
            font-weight: 600;
            text-transform: uppercase;
            border-radius: 4px;
            transition: 0.2s;
        }
        .nav-btn:hover, .nav-btn.active {
            background: rgba(0, 36, 84, 0.4);
            color: var(--nau-gold);
            border-color: rgba(250, 192, 26, 0.3);
        }

        /* Data Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-family: var(--font-code);
            font-size: 0.85rem;
        }
        .data-table th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid var(--nau-blue);
            color: var(--nau-gold);
            text-transform: uppercase;
        }
        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: var(--text-main);
        }
        .data-table tr:hover { background: rgba(255,255,255,0.03); }

        /* Equipment App */
        .equip-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        .equip-card {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--window-border);
            padding: 15px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .equip-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: var(--status-ok);
        }
        .equip-card.offline::before { background: var(--status-crit); }
        .equip-card.maint::before { background: var(--status-warn); }

        .equip-name { font-family: var(--font-ui); font-size: 1.1rem; font-weight: 700; color: var(--white); margin-bottom: 5px; }
        .equip-id { font-family: var(--font-code); font-size: 0.7rem; color: var(--text-muted); display: block; margin-bottom: 15px; }
        .equip-status { font-size: 0.8rem; font-weight: 600; text-transform: uppercase; }
        .text-ok { color: var(--status-ok); } .text-warn { color: var(--status-warn); } .text-crit { color: var(--status-crit); }

        /* Wafer Map App */
        .wafer-stage {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: radial-gradient(circle at center, #0a1525 0%, #000 100%);
        }
        .wafer-container {
            width: 400px; height: 400px;
            position: relative;
            animation: rotateWafer 60s linear infinite;
        }
        .wafer {
            width: 100%; height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #111, #222, #111);
            box-shadow: inset 0 0 20px #000, 0 0 30px rgba(0, 36, 84, 0.5);
            position: relative;
            overflow: hidden;
            border: 1px solid #333;
        }
        /* Simulated flat edge */
        .wafer::after {
            content: '';
            position: absolute;
            bottom: 5px; left: 50%;
            transform: translateX(-50%);
            width: 200px; height: 20px;
            background: #000;
        }
        
        .die-grid {
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            width: 100%; height: 100%;
            padding: 40px;
        }
        .die {
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.1s;
        }
        .die:hover { background: var(--nau-gold); box-shadow: 0 0 10px var(--nau-gold); }
        .die.defect { background: rgba(255, 42, 42, 0.5); }

        /* Task Manager / Dock */
        #dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 18, 41, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 10px 20px;
            display: flex;
            gap: 15px;
            z-index: var(--z-overlay);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 1s 0.5s;
        }

        .dock-item {
            width: 48px; height: 48px;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--text-muted);
            transition: 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        .dock-item:hover {
            transform: translateY(-10px) scale(1.1);
            color: var(--nau-gold);
            background: rgba(255,255,255,0.1);
        }

        .dock-item.running::after {
            content: '';
            position: absolute;
            bottom: -5px;
            width: 4px; height: 4px;
            border-radius: 50%;
            background: var(--nau-gold);
        }

        /* ================================================================================
        7. UTILITIES
        ================================================================================
        */
        .hidden { display: none !important; }
        .flex-col { display: flex; flex-direction: column; }
        .flex-row { display: flex; }
        .gap-10 { gap: 10px; }
        .p-20 { padding: 20px; }
        .h-full { height: 100%; }
        .w-full { width: 100%; }
        .btn-action {
            background: var(--nau-blue);
            color: white;
            border: 1px solid var(--nau-blue);
            padding: 8px 16px;
            font-family: var(--font-ui);
            text-transform: uppercase;
            font-weight: 700;
            border-radius: 2px;
            transition: 0.2s;
        }
        .btn-action:hover { background: var(--nau-gold); color: #000; border-color: var(--nau-gold); }

    </style>
</head>
<body>

    <!-- CUSTOM CURSOR -->
    <div id="cursor"></div>

    <!-- BACKGROUND CANVAS -->
    <canvas id="bg-canvas"></canvas>
    <div class="scanlines"></div>

    <!-- BOOT SCREEN -->
    <div id="boot-screen">
        <div class="boot-logo">
            <!-- Simplified SVG NAU Logo Placeholder -->
            <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="5">
                <path d="M20 80 L20 20 L50 60 L80 20 L80 80" />
            </svg>
        </div>
        <div style="font-size: 1.5rem; letter-spacing: 4px; margin-bottom: 10px;">NAU.OS <span style="color:var(--nau-blue);">V4.0</span></div>
        <div style="font-size: 0.8rem; color: #666; margin-bottom: 20px;">MPCT LABORATORY CONTROL SYSTEM</div>
        
        <div class="boot-log" id="boot-log">
            <!-- JS inserts logs here -->
        </div>

        <div class="loading-bar">
            <div class="loading-progress" id="load-bar"></div>
        </div>
    </div>

    <!-- MAIN DESKTOP -->
    <div id="desktop">
        
        <!-- SYSTEM BAR -->
        <div class="system-bar">
            <div class="sys-left">
                <div class="sys-logo">NAU<span>.OS</span></div>
                <div class="sys-status"><div class="sys-dot"></div> SYSTEM NORMAL</div>
            </div>
            <div class="sys-right">
                <div>USER: DR. A. JENSEN [ADMIN]</div>
                <div id="sys-clock" class="sys-clock">10:42:05 AM</div>
            </div>
        </div>

        <!-- DESKTOP SHORTCUTS -->
        <div class="shortcut-grid">
            <div class="shortcut" onclick="os.openApp('equipApp')">
                <div class="shortcut-icon">‚öô</div>
                <div class="shortcut-label">Equipment Control</div>
            </div>
            <div class="shortcut" onclick="os.openApp('waferApp')">
                <div class="shortcut-icon">‚óé</div>
                <div class="shortcut-label">Wafer Inspection</div>
            </div>
            <div class="shortcut" onclick="os.openApp('envApp')">
                <div class="shortcut-icon">‚âã</div>
                <div class="shortcut-label">Environment</div>
            </div>
            <div class="shortcut" onclick="os.openApp('rosterApp')">
                <div class="shortcut-icon">üë•</div>
                <div class="shortcut-label">Personnel</div>
            </div>
            <div class="shortcut" onclick="alert('Access Restricted: Level 5 Clearance Required')">
                <div class="shortcut-icon" style="color:var(--status-crit); border-color:var(--status-crit);">üîí</div>
                <div class="shortcut-label" style="color:var(--status-crit);">Security</div>
            </div>
        </div>

        <!-- WIDGETS -->
        <div class="widget-area">
            <div class="widget">
                <div class="widget-title">Cleanroom Atmosphere</div>
                <div class="env-grid">
                    <div class="env-item">
                        <div class="env-val text-ok">45%</div>
                        <div class="env-label">Humidity</div>
                    </div>
                    <div class="env-item">
                        <div class="env-val text-ok">21.5¬∞C</div>
                        <div class="env-label">Temp</div>
                    </div>
                    <div class="env-item">
                        <div class="env-val text-ok">1020</div>
                        <div class="env-label">Pressure (hPa)</div>
                    </div>
                    <div class="env-item">
                        <div class="env-val text-ok">C-100</div>
                        <div class="env-label">ISO Class</div>
                    </div>
                </div>
            </div>

            <div class="widget">
                <div class="widget-title">Live Alerts</div>
                <div class="notif-list">
                    <div class="notif-item urgent">
                        <span class="notif-time">10:30 AM</span>
                        DRIE Etcher: Pump pressure warning.
                    </div>
                    <div class="notif-item">
                        <span class="notif-time">09:15 AM</span>
                        Scheduled maintenance: Litho Bay 2.
                    </div>
                    <div class="notif-item">
                        <span class="notif-time">08:00 AM</span>
                        Shift change completed.
                    </div>
                </div>
            </div>
        </div>

        <!-- APP WINDOWS -->
        
        <!-- 1. EQUIPMENT APP -->
        <div id="equipApp" class="window" style="top: 100px; left: 200px; width: 900px; height: 600px;">
            <div class="title-bar">
                <div class="title-drag-area"><span class="title-icon">‚öô</span> Equipment Status & Control</div>
                <div class="window-controls">
                    <button class="win-btn win-min" onclick="os.minimizeWindow('equipApp')"></button>
                    <button class="win-btn win-max" onclick="os.maximizeWindow('equipApp')"></button>
                    <button class="win-btn win-close" onclick="os.closeWindow('equipApp')"></button>
                </div>
            </div>
            <div class="window-content app-layout">
                <div class="app-sidebar">
                    <button class="nav-btn active">All Systems</button>
                    <button class="nav-btn">Lithography</button>
                    <button class="nav-btn">Deposition</button>
                    <button class="nav-btn">Etch</button>
                    <button class="nav-btn">Metrology</button>
                </div>
                <div class="app-main">
                    <div class="equip-grid" id="equip-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. WAFER INSPECTION APP -->
        <div id="waferApp" class="window" style="top: 150px; left: 300px; width: 800px; height: 550px;">
            <div class="title-bar">
                <div class="title-drag-area"><span class="title-icon">‚óé</span> Optical Inspection System</div>
                <div class="window-controls">
                    <button class="win-btn win-min" onclick="os.minimizeWindow('waferApp')"></button>
                    <button class="win-btn win-max" onclick="os.maximizeWindow('waferApp')"></button>
                    <button class="win-btn win-close" onclick="os.closeWindow('waferApp')"></button>
                </div>
            </div>
            <div class="window-content flex-row h-full">
                <div style="flex: 2; padding: 20px; background: #000;">
                    <div class="wafer-stage">
                        <div class="wafer-container">
                            <div class="wafer">
                                <div class="die-grid" id="die-grid"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="flex: 1; border-left: 1px solid var(--window-border); padding: 20px; background: rgba(0,0,0,0.5);">
                    <h3 style="color:var(--nau-gold); margin-bottom:10px;">Inspection Log</h3>
                    <div style="font-family:var(--font-code); font-size:0.8rem; color:var(--text-muted);">
                        <p>> Initializing Optic Array...</p>
                        <p>> Focus: OK</p>
                        <p>> Alignment: 99.8%</p>
                        <p>> Scan Layer: Metal 2</p>
                        <hr style="border-color:rgba(255,255,255,0.1); margin: 10px 0;">
                        <div id="wafer-stats">
                            <p>Dies Total: 400</p>
                            <p>Defects: <span class="text-crit">0</span></p>
                            <p>Yield: <span class="text-ok">100%</span></p>
                        </div>
                    </div>
                    <button class="btn-action w-full" style="margin-top:20px;" onclick="os.scanWafer()">Run Deep Scan</button>
                </div>
            </div>
        </div>

        <!-- 3. PERSONNEL APP -->
        <div id="rosterApp" class="window" style="top: 80px; left: 150px; width: 700px; height: 500px;">
            <div class="title-bar">
                <div class="title-drag-area"><span class="title-icon">üë•</span> Personnel Database</div>
                <div class="window-controls">
                    <button class="win-btn win-min" onclick="os.minimizeWindow('rosterApp')"></button>
                    <button class="win-btn win-max" onclick="os.maximizeWindow('rosterApp')"></button>
                    <button class="win-btn win-close" onclick="os.closeWindow('rosterApp')"></button>
                </div>
            </div>
            <div class="window-content app-layout">
                <div class="app-main">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody id="roster-body">
                            <!-- JS Populated -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 4. ENVIRONMENT APP (GRAPHS) -->
        <div id="envApp" class="window" style="top: 120px; left: 400px; width: 600px; height: 400px;">
            <div class="title-bar">
                <div class="title-drag-area"><span class="title-icon">‚âã</span> Environmental Monitoring</div>
                <div class="window-controls">
                    <button class="win-btn win-min" onclick="os.minimizeWindow('envApp')"></button>
                    <button class="win-btn win-max" onclick="os.maximizeWindow('envApp')"></button>
                    <button class="win-btn win-close" onclick="os.closeWindow('envApp')"></button>
                </div>
            </div>
            <div class="window-content p-20">
                <canvas id="env-chart" style="width:100%; height:100%;"></canvas>
            </div>
        </div>

    </div>

    <!-- DOCK / TASKBAR -->
    <div id="dock">
        <div class="dock-item" onclick="os.openApp('equipApp')" title="Equipment">‚öô</div>
        <div class="dock-item" onclick="os.openApp('waferApp')" title="Wafer">‚óé</div>
        <div class="dock-item" onclick="os.openApp('envApp')" title="Environment">‚âã</div>
        <div class="dock-item" onclick="os.openApp('rosterApp')" title="Roster">üë•</div>
    </div>

    <!-- 
    ================================================================================
    8. JAVASCRIPT LOGIC
    ================================================================================
    -->
    <script>
        class OperatingSystem {
            constructor() {
                this.windows = {};
                this.zIndexCounter = 100;
                this.bootTime = 3500; // ms
                this.init();
            }

            init() {
                this.runBootSequence();
                this.setupCursor();
                this.setupClock();
                this.setupBackground();
                this.setupWindows();
                this.generateData();
                this.startCharts();
            }

            /* --- BOOT SEQUENCE --- */
            runBootSequence() {
                const log = document.getElementById('boot-log');
                const bar = document.getElementById('load-bar');
                const messages = [
                    "Initializing Kernel...",
                    "Loading Drivers: GPU_0 [OK]",
                    "Loading Drivers: SENSOR_NET [OK]",
                    "Mounting File System...",
                    "Checking Security Protocols...",
                    "Connecting to NAU Mainframe...",
                    "MPCT Module Loaded.",
                    "System Ready."
                ];

                let delay = 0;
                messages.forEach((msg, i) => {
                    delay += Math.random() * 400 + 200;
                    setTimeout(() => {
                        const div = document.createElement('div');
                        div.className = 'log-line ' + (Math.random() > 0.9 ? 'warn' : 'success');
                        div.innerText = `> ${msg}`;
                        log.appendChild(div);
                        log.scrollTop = log.scrollHeight;
                        
                        // Bar progress
                        const progress = ((i + 1) / messages.length) * 100;
                        bar.style.width = `${progress}%`;

                    }, delay);
                });

                setTimeout(() => {
                    document.getElementById('boot-screen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('boot-screen').remove();
                        document.getElementById('desktop').style.opacity = '1';
                        document.getElementById('dock').style.opacity = '1';
                        // Auto open equipment app on boot
                        this.openApp('equipApp');
                    }, 500);
                }, this.bootTime);
            }

            /* --- MOUSE CURSOR --- */
            setupCursor() {
                const cursor = document.getElementById('cursor');
                document.addEventListener('mousemove', (e) => {
                    cursor.style.left = e.clientX + 'px';
                    cursor.style.top = e.clientY + 'px';
                });

                document.querySelectorAll('button, .shortcut, .dock-item, .window, .nav-btn').forEach(el => {
                    el.addEventListener('mouseenter', () => cursor.classList.add('hovered'));
                    el.addEventListener('mouseleave', () => cursor.classList.remove('hovered'));
                });
            }

            /* --- CLOCK --- */
            setupClock() {
                const el = document.getElementById('sys-clock');
                setInterval(() => {
                    el.innerText = new Date().toLocaleTimeString();
                }, 1000);
            }

            /* --- BACKGROUND PARTICLES --- */
            setupBackground() {
                const canvas = document.getElementById('bg-canvas');
                const ctx = canvas.getContext('2d');
                let width, height;
                const particles = [];

                const resize = () => {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                };
                window.addEventListener('resize', resize);
                resize();

                class Particle {
                    constructor() {
                        this.x = Math.random() * width;
                        this.y = Math.random() * height;
                        this.vx = (Math.random() - 0.5) * 0.5;
                        this.vy = (Math.random() - 0.5) * 0.5;
                        this.size = Math.random() * 2;
                        this.alpha = Math.random() * 0.5;
                    }
                    update() {
                        this.x += this.vx;
                        this.y += this.vy;
                        if(this.x < 0) this.x = width;
                        if(this.x > width) this.x = 0;
                        if(this.y < 0) this.y = height;
                        if(this.y > height) this.y = 0;
                    }
                    draw() {
                        ctx.fillStyle = `rgba(0, 58, 133, ${this.alpha})`;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }

                for(let i=0; i<100; i++) particles.push(new Particle());

                const animate = () => {
                    ctx.clearRect(0,0,width,height);
                    particles.forEach(p => { p.update(); p.draw(); });
                    
                    // Draw grid lines
                    ctx.strokeStyle = 'rgba(0, 36, 84, 0.1)';
                    ctx.lineWidth = 1;
                    const gridSize = 100;
                    
                    // Perspective Grid Effect
                    for(let i=0; i<width; i+=gridSize) {
                        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, height); ctx.stroke();
                    }
                    for(let i=0; i<height; i+=gridSize) {
                        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(width, i); ctx.stroke();
                    }

                    requestAnimationFrame(animate);
                };
                animate();
            }

            /* --- WINDOW MANAGER --- */
            setupWindows() {
                const windows = document.querySelectorAll('.window');
                windows.forEach(win => {
                    const id = win.id;
                    const header = win.querySelector('.title-bar');
                    this.windows[id] = { el: win, x: 0, y: 0 };

                    // Bring to front on click
                    win.addEventListener('mousedown', () => this.focusWindow(id));

                    // Dragging Logic
                    let isDragging = false;
                    let offsetX, offsetY;

                    header.addEventListener('mousedown', (e) => {
                        isDragging = true;
                        offsetX = e.clientX - win.offsetLeft;
                        offsetY = e.clientY - win.offsetTop;
                        this.focusWindow(id);
                    });

                    document.addEventListener('mousemove', (e) => {
                        if (isDragging) {
                            win.style.left = (e.clientX - offsetX) + 'px';
                            win.style.top = (e.clientY - offsetY) + 'px';
                        }
                    });

                    document.addEventListener('mouseup', () => {
                        isDragging = false;
                    });
                });
            }

            focusWindow(id) {
                this.zIndexCounter++;
                const win = document.getElementById(id);
                win.style.zIndex = this.zIndexCounter;
                
                // Visual active state
                document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
                win.classList.add('active');
            }

            openApp(id) {
                const win = document.getElementById(id);
                win.classList.remove('minimized');
                win.classList.add('open');
                this.focusWindow(id);
                
                // Update Dock Status
                document.querySelectorAll('.dock-item').forEach(d => {
                    // Simple check if onclick matches (in prod, use data attributes)
                    if(d.onclick.toString().includes(id)) d.classList.add('running');
                });
            }

            closeWindow(id) {
                const win = document.getElementById(id);
                win.classList.remove('open');
                // Remove running dot from dock
                document.querySelectorAll('.dock-item').forEach(d => {
                    if(d.onclick.toString().includes(id)) d.classList.remove('running');
                });
            }

            minimizeWindow(id) {
                const win = document.getElementById(id);
                win.classList.add('minimized');
            }

            maximizeWindow(id) {
                const win = document.getElementById(id);
                if(win.style.width === '100%') {
                    // Restore
                    win.style.width = '800px'; 
                    win.style.height = '600px';
                    win.style.top = '100px';
                    win.style.left = '200px';
                } else {
                    // Maximize (keeping space for top bar)
                    win.style.width = '100%';
                    win.style.height = 'calc(100% - 48px)';
                    win.style.top = '48px';
                    win.style.left = '0';
                }
            }

            /* --- CONTENT GENERATION --- */
            generateData() {
                // 1. Equipment
                const equipList = [
                    { name: "Karl Suss MA6", id: "LITHO-01", status: "Online" },
                    { name: "Zeiss Sigma 300", id: "SEM-01", status: "Online" },
                    { name: "Oxford PlasmaPro", id: "ETCH-02", status: "Offline" },
                    { name: "Lesker PVD 75", id: "DEP-01", status: "Maintenance" },
                    { name: "Disco DAD3220", id: "SAW-01", status: "Online" },
                    { name: "Tencor P-7", id: "MET-03", status: "Online" }
                ];

                const equipContainer = document.getElementById('equip-list');
                equipList.forEach(eq => {
                    let statusClass = 'text-ok';
                    let cardClass = '';
                    if(eq.status === 'Offline') { statusClass = 'text-crit'; cardClass = 'offline'; }
                    if(eq.status === 'Maintenance') { statusClass = 'text-warn'; cardClass = 'maint'; }

                    const html = `
                        <div class="equip-card ${cardClass}">
                            <div class="equip-name">${eq.name}</div>
                            <span class="equip-id">ID: ${eq.id}</span>
                            <div class="equip-status ${statusClass}">‚óè ${eq.status}</div>
                            <div style="margin-top:10px; font-size:0.75rem; color:#666;">
                                Pressure: ${(Math.random() * 10).toFixed(2)} mTorr<br>
                                Temp: ${(20 + Math.random() * 5).toFixed(1)} ¬∞C
                            </div>
                        </div>
                    `;
                    equipContainer.innerHTML += html;
                });

                // 2. Roster
                const roster = [
                    { id: "FAC-001", name: "Dr. A. Jensen", role: "Director", loc: "Office 204", status: "Active" },
                    { id: "FAC-002", name: "Dr. S. Patel", role: "Lead Eng", loc: "Cleanroom", status: "Active" },
                    { id: "STU-104", name: "M. O'Neil", role: "Grad Student", loc: "Lab 3", status: "Active" },
                    { id: "STU-105", name: "J. Doe", role: "Undergrad", loc: "Off Campus", status: "Inactive" },
                    { id: "STU-106", name: "K. Smith", role: "Grad Student", loc: "Cleanroom", status: "Active" },
                ];
                const rosterBody = document.getElementById('roster-body');
                roster.forEach(p => {
                    rosterBody.innerHTML += `
                        <tr>
                            <td>${p.id}</td>
                            <td>${p.name}</td>
                            <td>${p.role}</td>
                            <td style="color:${p.status === 'Active' ? 'var(--status-ok)' : 'var(--text-muted)'}">${p.status}</td>
                            <td>${p.loc}</td>
                        </tr>
                    `;
                });

                // 3. Wafer Dies
                const dieGrid = document.getElementById('die-grid');
                for(let i=0; i<400; i++) {
                    const div = document.createElement('div');
                    div.className = 'die';
                    // Random defects
                    if(Math.random() > 0.98) div.classList.add('defect');
                    dieGrid.appendChild(div);
                }
            }

            scanWafer() {
                const dies = document.querySelectorAll('.die');
                let count = 0;
                let defects = 0;
                
                // Reset styling
                dies.forEach(d => {
                    d.style.background = 'transparent';
                    d.classList.remove('defect');
                });

                const interval = setInterval(() => {
                    if(count >= dies.length) {
                        clearInterval(interval);
                        // Update stats
                        const yieldRate = ((dies.length - defects) / dies.length * 100).toFixed(1);
                        document.getElementById('wafer-stats').innerHTML = `
                            <p>Dies Total: ${dies.length}</p>
                            <p>Defects: <span class="text-crit">${defects}</span></p>
                            <p>Yield: <span class="${yieldRate > 90 ? 'text-ok' : 'text-warn'}">${yieldRate}%</span></p>
                        `;
                        return;
                    }

                    // Visual scan line effect
                    dies[count].style.background = 'var(--nau-gold)';
                    setTimeout((el) => el.style.background = 'transparent', 50, dies[count]);

                    // Randomly find defect
                    if(Math.random() > 0.95) {
                        dies[count].classList.add('defect');
                        defects++;
                    }

                    count++;
                }, 5); // Fast scan
            }

            /* --- CHARTS (ENV APP) --- */
            startCharts() {
                const canvas = document.getElementById('env-chart');
                const ctx = canvas.getContext('2d');
                
                // Mock data history
                const data = new Array(100).fill(0).map(() => 20 + Math.random() * 2);
                let xOffset = 0;

                const draw = () => {
                    // Resize logic simplified
                    const w = canvas.width = canvas.parentElement.offsetWidth;
                    const h = canvas.height = canvas.parentElement.offsetHeight;

                    ctx.clearRect(0,0,w,h);
                    
                    // Grid
                    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    for(let i=0; i<w; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i,h); }
                    for(let i=0; i<h; i+=50) { ctx.moveTo(0,i); ctx.lineTo(w,i); }
                    ctx.stroke();

                    // Update Data
                    data.shift();
                    data.push(20 + Math.sin(xOffset * 0.1) + Math.random());
                    xOffset++;

                    // Draw Line
                    ctx.strokeStyle = '#00ff9d';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    for(let i=0; i<data.length; i++) {
                        const x = (i / data.length) * w;
                        const y = h - ((data[i] - 15) / 10) * h; // Scale loosely
                        if(i===0) ctx.moveTo(x,y);
                        else ctx.lineTo(x,y);
                    }
                    ctx.stroke();

                    // Fill under
                    ctx.lineTo(w, h);
                    ctx.lineTo(0, h);
                    ctx.fillStyle = 'rgba(0, 255, 157, 0.1)';
                    ctx.fill();

                    requestAnimationFrame(draw);
                };
                draw();
            }
        }

        // Init App
        const os = new OperatingSystem();

    </script>
</body>
</html>